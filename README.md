# UrbanBelonging

This repository is the home of the Urban Belonging mobile app. It's built using React Native + Expo + TypeScript

# Technologies Used

**Build Tooling:** [Expo](https://expo.dev/) is used for build tooling, native modules and releases. [EAS Build](https://docs.expo.dev/build/introduction/) is used for compiling native releases and automatically treeshakes any unused dependencies to reduce the final bundle size. A premium subscription to EAS is recommended to avoid long build queues.

**Navigation:** [React Navigation](https://reactnavigation.org/docs/getting-started/) is used for navigation between screens

**HTTP Client:** [https://axios-http.com/](axios) is used for making requests to the [urbanbelonging-api](https://github.com/Urban-Belonging/urbanbelonging-api)

**Logging/Instrumentation:** [https://sentry.io/welcome/](Sentry) is used for logging uncaught exceptions

**Native Modules:** Various Expo native modules are used in this app.

# Configuration

Some basic configuration values are stored in [config.ts](https://github.com/Urban-Belonging/UrbanBelonging/blob/main/lib/config.ts). You'll find various other configuration files in the root of this project that pertain to native modules, Expo etc. There are various configuration files in this project which need to have hardcoded secrets — this is not ideal and will be changed in future. Don't make a fork of this repository public.

**app.config.ts:** Allows you to add extra config values at compile time which are passed to the `expo-constants` module

**app.json:** The main configuration file that Expo uses for bundling releases of this app. The versions for native releases can be changed here as well as requested permissions, API keys, configuration values for native modules.

**eas.json:** This is used by the EAS Build service.

**google-services.json:** Used for signed Android builds. You'll need to upload your own version that's generated by the Google account you use to publish this app.

**package.json:** This file contains a hardcoded `API_BASE_URL` environment variable. As Expo development builds are intended to be run on the device (this is also faster than running emulators), the device you're testing with must be on the same network as your development server or exposed via a tunnel. Change this IP address to the one you are using locally and the `urbanbelonging-api` is running on.

## Configuring prompts/annotations/reactions

Please see the documentation in the [urbanbelonging-api](https://github.com/Urban-Belonging/urbanbelonging-api) repository for how prompts/annotations/reactions can be configured. It involves copying a file to both the backend and frontend and creating a new release.

# Development

You can start the development server by running `yarn start`. This spins up an Expo development server and allows you to open the app using the Expo Go app. See the notes above about the IP address in `package.json` needing to be pointed to the local IP of your machine on the network.

To run the app on an emulator, you can run `yarn run ios` or `yarn run android` respectively. As this app uses location, cameras and other native APIs that don't always play well with emulators, it's recommended to run development builds on a physical device. Please note [there are some caveats](https://docs.expo.dev/introduction/why-not-expo/) with the Expo Go app.

# Building a release

Building a release involves a few steps:

- Bumping `expo.version` in `app.json`
- Bumping `expo.extra.displayVersion` in `app.json`
- Bumping `expo.ios.buildNumber` in `app.json`
- Bumping `expo.android.versionCode` in `app.json`

You should then commit your changes and run `yarn run build-eas:ios` and `yarn run build-eas:android` respectively. This will use the Expo CLI to send the build to EAS build which will then be built in the cloud and will generate binaries you can upload to the app stores. You'll need to setup and authenticate your Expo CLI before doing this. You might need to jump through some hoops with iOS login — you can use the NPM script `yarn run build-eas:ios-login` to go through this.

# Over the air updates

If you're shipping a small change to the app that doesn't change any native modules/requesting permissions, you can publish an over-the-air (OTA) update via Expo which will be downloaded by any mobile clients on the next launch of the app. Once they restart the app again, they'll have the latest version, without needing to update via the app stores. You can run `expo publish` to publish these updates.

# Localization

Localization files are used [here](https://github.com/Urban-Belonging/UrbanBelonging/blob/main/lib/i18n/index.ts). You can add your own locales — ensure you name the key using the first 2 letters of the ISO 639-1 language code, i.e. naming it `en` which will be used for both the `en-GB`/`en-US` locales. The default locale used is English.
